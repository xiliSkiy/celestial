# 拓扑功能部署验证清单

## 前置条件检查

### 后端检查

- [ ] 数据库迁移已执行
  ```bash
  cd gravital-core
  make migrate-up
  ```
  
- [ ] 后端服务正常运行
  ```bash
  cd gravital-core
  make run
  ```

- [ ] 检查数据表是否创建成功
  ```sql
  \dt topologies
  \dt topology_nodes
  \dt topology_links
  \dt topology_groups
  \dt topology_versions
  \dt lldp_neighbors
  ```

### 前端检查

- [ ] G6 依赖已安装
  ```bash
  cd gravital-core/web
  npm install @antv/g6
  ```

- [ ] 前端服务正常运行
  ```bash
  cd gravital-core/web
  npm run dev
  ```

## 功能验证

### 1. 菜单显示验证

- [ ] 登录系统
- [ ] 侧边栏显示"网络拓扑"菜单项
- [ ] 菜单图标正确显示（Share 图标）
- [ ] 菜单位置正确（在告警管理和数据转发之间）

### 2. 路由跳转验证

- [ ] 点击"网络拓扑"菜单
- [ ] 成功跳转到 `/topology` 页面
- [ ] 页面正常加载，无错误
- [ ] 面包屑显示: `首页 / 网络拓扑`

### 3. 拓扑列表功能验证

- [ ] 显示拓扑列表（可能为空）
- [ ] 搜索框正常工作
- [ ] 类型和范围过滤器正常工作
- [ ] "创建拓扑"按钮可点击

### 4. 创建拓扑验证

- [ ] 点击"创建拓扑"按钮
- [ ] 弹出创建对话框
- [ ] 填写表单：
  - 名称: 测试拓扑
  - 类型: 物理拓扑
  - 范围: 数据中心
  - 布局: 力导向
- [ ] 点击"确定"创建成功
- [ ] 列表中显示新创建的拓扑

### 5. 拓扑详情验证

- [ ] 点击拓扑名称
- [ ] 跳转到拓扑详情页 `/topology/:id`
- [ ] 拓扑画布正常显示
- [ ] 工具栏按钮正常显示
- [ ] 面包屑显示: `首页 / 拓扑详情`

### 6. 节点操作验证

- [ ] 点击"添加节点"按钮
- [ ] 弹出添加节点对话框
- [ ] 填写节点信息
- [ ] 成功添加节点
- [ ] 节点在画布上显示

### 7. 链路操作验证

- [ ] 添加第二个节点
- [ ] 点击"添加链路"按钮
- [ ] 选择源节点和目标节点
- [ ] 成功添加链路
- [ ] 链路在画布上显示

### 8. 交互功能验证

- [ ] 拖拽节点正常工作
- [ ] 缩放画布正常工作（滚轮）
- [ ] 平移画布正常工作（拖拽空白区域）
- [ ] 点击节点显示详情面板
- [ ] 点击链路显示详情面板

### 9. 布局切换验证

- [ ] 切换到"层次布局"
- [ ] 节点重新排列
- [ ] 切换到"环形布局"
- [ ] 节点重新排列
- [ ] 切换到"网格布局"
- [ ] 节点重新排列

### 10. 版本管理验证

- [ ] 点击"创建快照"
- [ ] 输入快照描述
- [ ] 快照创建成功
- [ ] 点击"版本历史"
- [ ] 显示版本列表
- [ ] 点击"恢复"按钮
- [ ] 版本恢复成功

## 权限验证

### 1. 无权限用户

- [ ] 创建一个没有 `topology.read` 权限的用户
- [ ] 登录该用户
- [ ] 侧边栏不显示"网络拓扑"菜单
- [ ] 直接访问 `/topology` 被拦截

### 2. 只读权限用户

- [ ] 创建一个只有 `topology.read` 权限的用户
- [ ] 登录该用户
- [ ] 可以查看拓扑列表
- [ ] 可以查看拓扑详情
- [ ] "创建拓扑"按钮不可用或隐藏
- [ ] "添加节点"按钮不可用或隐藏

### 3. 完整权限用户

- [ ] 创建一个有 `topology.read`, `topology.write`, `topology.delete` 权限的用户
- [ ] 登录该用户
- [ ] 所有功能正常使用

## API 验证

### 1. 拓扑管理 API

```bash
# 获取拓扑列表
curl -X GET http://localhost:8080/api/v1/topologies \
  -H "Authorization: Bearer YOUR_TOKEN"

# 创建拓扑
curl -X POST http://localhost:8080/api/v1/topologies \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "测试拓扑",
    "type": "physical",
    "scope": "datacenter",
    "layout_type": "force"
  }'

# 获取拓扑详情
curl -X GET http://localhost:8080/api/v1/topologies/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 2. 节点管理 API

```bash
# 添加节点
curl -X POST http://localhost:8080/api/v1/topologies/1/nodes \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "device_id": "dev-001",
    "node_type": "device",
    "label": "测试节点",
    "layer": 0
  }'
```

### 3. 链路管理 API

```bash
# 添加链路
curl -X POST http://localhost:8080/api/v1/topologies/1/links \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "source_node_id": 1,
    "target_node_id": 2,
    "link_type": "physical"
  }'
```

## 性能验证

### 1. 小规模拓扑 (< 100 节点)

- [ ] 创建包含 50 个节点的拓扑
- [ ] 页面加载时间 < 2 秒
- [ ] 拖拽流畅，无卡顿
- [ ] 缩放流畅

### 2. 中等规模拓扑 (100-500 节点)

- [ ] 创建包含 200 个节点的拓扑
- [ ] 页面加载时间 < 5 秒
- [ ] 交互基本流畅

### 3. 大规模拓扑 (> 500 节点)

- [ ] 创建包含 1000 个节点的拓扑
- [ ] 页面可以加载（可能较慢）
- [ ] 考虑启用虚拟化渲染

## 浏览器兼容性验证

- [ ] Chrome 最新版
- [ ] Firefox 最新版
- [ ] Safari 最新版
- [ ] Edge 最新版

## 错误处理验证

### 1. 网络错误

- [ ] 断开网络连接
- [ ] 操作拓扑
- [ ] 显示友好的错误提示
- [ ] 恢复网络后可以继续操作

### 2. 权限错误

- [ ] 使用无权限用户操作
- [ ] 显示权限不足提示

### 3. 数据验证错误

- [ ] 创建拓扑时不填必填字段
- [ ] 显示验证错误提示
- [ ] 添加链路时选择相同的源和目标节点
- [ ] 显示错误提示

## 问题记录

如果发现问题，请记录：

| 问题描述 | 严重程度 | 重现步骤 | 状态 |
|---------|---------|---------|------|
|         |         |         |      |

## 验证结论

- [ ] 所有功能正常
- [ ] 性能满足要求
- [ ] 权限控制正常
- [ ] 错误处理完善
- [ ] 可以投入使用

## 备注

验证日期: ___________
验证人员: ___________
环境信息: ___________

---

**验证通过标准**:
- 核心功能全部正常
- 无阻塞性 bug
- 性能满足基本要求
- 用户体验良好

