# æ‰‹åŠ¨è§¦å‘é‡‡é›†æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•ä½¿ç”¨ `sentinel trigger` å‘½ä»¤æ‰‹åŠ¨è§¦å‘é‡‡é›†ä»»åŠ¡ï¼Œç”¨äºæµ‹è¯•æ’ä»¶æˆ–ç«‹å³æ‰§è¡Œå·¡æ£€ã€‚

## æ¦‚è¿°

`sentinel trigger` å‘½ä»¤å…è®¸ä½ åœ¨ä¸å¯åŠ¨å®Œæ•´æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡æ•°æ®é‡‡é›†ä»»åŠ¡ã€‚è¿™å¯¹ä»¥ä¸‹åœºæ™¯éå¸¸æœ‰ç”¨ï¼š

- âœ… **æµ‹è¯•æ’ä»¶** - éªŒè¯æ’ä»¶é…ç½®æ˜¯å¦æ­£ç¡®
- âœ… **æ•…éšœæ’æŸ¥** - ç«‹å³æ£€æŸ¥è®¾å¤‡çŠ¶æ€
- âœ… **å¼€å‘è°ƒè¯•** - å¼€å‘æ–°æ’ä»¶æ—¶å¿«é€Ÿæµ‹è¯•
- âœ… **æ‰‹åŠ¨å·¡æ£€** - éœ€è¦ç«‹å³è·å–è®¾å¤‡ä¿¡æ¯

## åŸºæœ¬ç”¨æ³•

### æŸ¥çœ‹å¸®åŠ©

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è§¦å‘å‘½ä»¤
./bin/sentinel trigger --help

# æŸ¥çœ‹ç‰¹å®šæ’ä»¶çš„å¸®åŠ©
./bin/sentinel trigger ping --help
```

### Ping é‡‡é›†

#### åŸºæœ¬ç”¨æ³•

```bash
# æœ€ç®€å•çš„ç”¨æ³• - ä½¿ç”¨é»˜è®¤å‚æ•°
./bin/sentinel trigger ping 8.8.8.8
```

#### è‡ªå®šä¹‰å‚æ•°

```bash
# æŒ‡å®š Ping æ¬¡æ•°
./bin/sentinel trigger ping 8.8.8.8 -n 5

# æŒ‡å®š Ping é—´éš”
./bin/sentinel trigger ping 8.8.8.8 -i 2s

# æŒ‡å®šè¶…æ—¶æ—¶é—´
./bin/sentinel trigger ping 8.8.8.8 -t 10s

# ç»„åˆä½¿ç”¨
./bin/sentinel trigger ping 8.8.8.8 -n 10 -i 500ms -t 15s
```

#### å‚æ•°è¯´æ˜

| å‚æ•° | çŸ­é€‰é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|--------|------|
| --count | -n | 4 | Ping æ¬¡æ•° |
| --interval | -i | 1s | Ping é—´éš” |
| --timeout | -t | 5s | è¶…æ—¶æ—¶é—´ |

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: æµ‹è¯•æœ¬åœ°ç½‘å…³

```bash
./bin/sentinel trigger ping 192.168.1.1
```

**è¾“å‡ºç¤ºä¾‹**:
```
ğŸš€ è§¦å‘ Ping é‡‡é›†: 192.168.1.1
   å‚æ•°: count=4, interval=1s, timeout=5s

â³ æ‰§è¡Œé‡‡é›†ä¸­...

âœ… é‡‡é›†æˆåŠŸ! è€—æ—¶: 3.012s

ğŸ“Š é‡‡é›†æŒ‡æ ‡:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æŒ‡æ ‡ #1:
  åç§°: ping_reachable
  å€¼:   1.00 
  ç±»å‹: gauge
  æ—¶é—´: 2025-11-01 21:22:32
  æ ‡ç­¾:
    device_id: 192.168.1.1
    host: 192.168.1.1

æŒ‡æ ‡ #2:
  åç§°: ping_rtt_ms
  å€¼:   1.23 ms
  ç±»å‹: gauge
  æ—¶é—´: 2025-11-01 21:22:32
  æ ‡ç­¾:
    device_id: 192.168.1.1
    host: 192.168.1.1

æŒ‡æ ‡ #3:
  åç§°: ping_packet_loss
  å€¼:   0.00 
  ç±»å‹: gauge
  æ—¶é—´: 2025-11-01 21:22:32
  æ ‡ç­¾:
    device_id: 192.168.1.1
    host: 192.168.1.1

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ æç¤º: æ•°æ®å·²é‡‡é›†ä½†æœªå‘é€åˆ°æ•°æ®åº“
   å¦‚éœ€è‡ªåŠ¨å‘é€ï¼Œè¯·ä½¿ç”¨ 'sentinel start' å¯åŠ¨æœåŠ¡
```

### ç¤ºä¾‹ 2: æµ‹è¯•è¿œç¨‹æœåŠ¡å™¨

```bash
# æµ‹è¯• Google DNS
./bin/sentinel trigger ping 8.8.8.8 -n 10

# æµ‹è¯•é˜¿é‡Œäº‘ DNS
./bin/sentinel trigger ping 223.5.5.5 -n 10

# æµ‹è¯• Cloudflare DNS
./bin/sentinel trigger ping 1.1.1.1 -n 10
```

### ç¤ºä¾‹ 3: å¿«é€Ÿæ£€æµ‹

```bash
# å¿«é€Ÿæ£€æµ‹ï¼ˆåª ping 1 æ¬¡ï¼‰
./bin/sentinel trigger ping 192.168.1.100 -n 1

# å¿«é€Ÿæ‰¹é‡æ£€æµ‹
for ip in 192.168.1.{1..10}; do
  echo "Testing $ip..."
  ./bin/sentinel trigger ping $ip -n 1
done
```

### ç¤ºä¾‹ 4: é•¿æ—¶é—´ç›‘æ§

```bash
# é•¿æ—¶é—´ pingï¼ˆ30 æ¬¡ï¼Œé—´éš” 2 ç§’ï¼‰
./bin/sentinel trigger ping 192.168.1.1 -n 30 -i 2s -t 60s
```

## è¾“å‡ºè¯´æ˜

### æŒ‡æ ‡ç±»å‹

é‡‡é›†å‘½ä»¤ä¼šè¾“å‡ºä»¥ä¸‹æŒ‡æ ‡ï¼š

#### 1. ping_reachable
- **ç±»å‹**: gauge
- **å€¼**: 1.0 (å¯è¾¾) æˆ– 0.0 (ä¸å¯è¾¾)
- **è¯´æ˜**: ç›®æ ‡ä¸»æœºæ˜¯å¦å¯è¾¾

#### 2. ping_rtt_ms
- **ç±»å‹**: gauge
- **å€¼**: å¾€è¿”æ—¶å»¶ï¼ˆæ¯«ç§’ï¼‰
- **è¯´æ˜**: å¹³å‡å¾€è¿”æ—¶é—´

#### 3. ping_packet_loss
- **ç±»å‹**: gauge
- **å€¼**: ä¸¢åŒ…ç‡ï¼ˆ0.0-1.0ï¼‰
- **è¯´æ˜**: æ•°æ®åŒ…ä¸¢å¤±æ¯”ä¾‹

### æ ‡ç­¾è¯´æ˜

æ¯ä¸ªæŒ‡æ ‡éƒ½åŒ…å«ä»¥ä¸‹æ ‡ç­¾ï¼š

- `device_id`: è®¾å¤‡ IDï¼ˆç­‰äºç›®æ ‡ä¸»æœºï¼‰
- `host`: ç›®æ ‡ä¸»æœºåœ°å€

## ä¸æœåŠ¡æ¨¡å¼çš„åŒºåˆ«

### Trigger æ¨¡å¼ï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰

```bash
./bin/sentinel trigger ping 8.8.8.8
```

**ç‰¹ç‚¹**:
- âœ… ç«‹å³æ‰§è¡Œï¼Œç«‹å³è¿”å›ç»“æœ
- âœ… ä¸éœ€è¦é…ç½®æ–‡ä»¶
- âœ… æ•°æ®ä¸ä¼šè‡ªåŠ¨å‘é€åˆ°æ•°æ®åº“
- âœ… é€‚åˆæµ‹è¯•å’Œè°ƒè¯•
- âŒ ä¸æ”¯æŒå®šæ—¶é‡‡é›†
- âŒ ä¸æ”¯æŒå¤šä»»åŠ¡å¹¶å‘

### Service æ¨¡å¼ï¼ˆæœåŠ¡è¿è¡Œï¼‰

```bash
./bin/sentinel start -c config.yaml
```

**ç‰¹ç‚¹**:
- âœ… åå°æŒç»­è¿è¡Œ
- âœ… è‡ªåŠ¨å®šæ—¶é‡‡é›†
- âœ… æ•°æ®è‡ªåŠ¨å‘é€åˆ°æ•°æ®åº“
- âœ… æ”¯æŒå¤šä»»åŠ¡å¹¶å‘
- âœ… æ”¯æŒä»»åŠ¡è°ƒåº¦
- âŒ éœ€è¦é…ç½®æ–‡ä»¶
- âŒ éœ€è¦ä¸­å¿ƒç«¯æˆ–æ•°æ®åº“

## å¸¸è§é—®é¢˜

### Q1: è§¦å‘é‡‡é›†åæ•°æ®å»å“ªäº†ï¼Ÿ

**A**: `trigger` å‘½ä»¤åªæ‰§è¡Œé‡‡é›†å¹¶æ˜¾ç¤ºç»“æœï¼Œ**ä¸ä¼š**å°†æ•°æ®å‘é€åˆ°æ•°æ®åº“ã€‚å¦‚æœéœ€è¦æŒä¹…åŒ–æ•°æ®ï¼Œè¯·ä½¿ç”¨ `sentinel start` å¯åŠ¨æœåŠ¡ã€‚

### Q2: å¯ä»¥è§¦å‘å¤šä¸ªè®¾å¤‡å—ï¼Ÿ

**A**: å•æ¬¡å‘½ä»¤åªèƒ½è§¦å‘ä¸€ä¸ªè®¾å¤‡ã€‚å¦‚éœ€æ‰¹é‡è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨ shell è„šæœ¬ï¼š

```bash
#!/bin/bash
hosts=(
  "8.8.8.8"
  "1.1.1.1"
  "223.5.5.5"
)

for host in "${hosts[@]}"; do
  echo "=== Testing $host ==="
  ./bin/sentinel trigger ping "$host" -n 3
  echo ""
done
```

### Q3: è§¦å‘é‡‡é›†å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**å¸¸è§åŸå› **:
1. ç›®æ ‡ä¸»æœºä¸å¯è¾¾
2. ç½‘ç»œé˜²ç«å¢™é˜»æ­¢ ICMP
3. æƒé™ä¸è¶³ï¼ˆæŸäº›ç³»ç»Ÿéœ€è¦ root æƒé™ï¼‰
4. è¶…æ—¶æ—¶é—´å¤ªçŸ­

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¢åŠ è¶…æ—¶æ—¶é—´
./bin/sentinel trigger ping 192.168.1.1 -t 30s

# ä½¿ç”¨ sudoï¼ˆå¦‚æœéœ€è¦ï¼‰
sudo ./bin/sentinel trigger ping 192.168.1.1
```

### Q4: å¦‚ä½•ä¿å­˜é‡‡é›†ç»“æœï¼Ÿ

**æ–¹æ³• 1**: é‡å®šå‘åˆ°æ–‡ä»¶

```bash
./bin/sentinel trigger ping 8.8.8.8 > result.txt
```

**æ–¹æ³• 2**: ä½¿ç”¨ JSON æ ¼å¼ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰

```bash
# è®¡åˆ’æ”¯æŒ
./bin/sentinel trigger ping 8.8.8.8 --format json > result.json
```

**æ–¹æ³• 3**: ä½¿ç”¨æœåŠ¡æ¨¡å¼è‡ªåŠ¨ä¿å­˜

```bash
./bin/sentinel start -c config.yaml
```

## é«˜çº§ç”¨æ³•

### æ‰¹é‡æµ‹è¯•è„šæœ¬

åˆ›å»º `batch-ping.sh`:

```bash
#!/bin/bash

# æ‰¹é‡ Ping æµ‹è¯•è„šæœ¬
HOSTS_FILE="hosts.txt"
RESULTS_DIR="results"

mkdir -p "$RESULTS_DIR"

while IFS= read -r host; do
  echo "Testing $host..."
  timestamp=$(date +%Y%m%d_%H%M%S)
  output_file="$RESULTS_DIR/${host}_${timestamp}.txt"
  
  ./bin/sentinel trigger ping "$host" -n 5 > "$output_file"
  
  if [ $? -eq 0 ]; then
    echo "âœ… $host - Success"
  else
    echo "âŒ $host - Failed"
  fi
done < "$HOSTS_FILE"

echo "All tests completed. Results saved in $RESULTS_DIR/"
```

ä½¿ç”¨æ–¹æ³•ï¼š

```bash
# åˆ›å»ºä¸»æœºåˆ—è¡¨
cat > hosts.txt <<EOF
8.8.8.8
1.1.1.1
223.5.5.5
192.168.1.1
EOF

# è¿è¡Œæ‰¹é‡æµ‹è¯•
chmod +x batch-ping.sh
./batch-ping.sh
```

### å®šæ—¶è§¦å‘

ä½¿ç”¨ cron å®šæ—¶è§¦å‘ï¼š

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
0 * * * * cd /path/to/orbital-sentinels && ./bin/sentinel trigger ping 8.8.8.8 >> /var/log/ping-check.log 2>&1

# æ¯ 5 åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡
*/5 * * * * cd /path/to/orbital-sentinels && ./bin/sentinel trigger ping 192.168.1.1 >> /var/log/gateway-check.log 2>&1
```

### ç›‘æ§è„šæœ¬

åˆ›å»ºç®€å•çš„ç›‘æ§è„šæœ¬ï¼š

```bash
#!/bin/bash

# ç®€å•çš„å¯ç”¨æ€§ç›‘æ§
HOST="192.168.1.1"
ALERT_EMAIL="admin@example.com"

result=$(./bin/sentinel trigger ping "$HOST" -n 3)

if echo "$result" | grep -q "ping_reachable.*1.00"; then
  echo "âœ… $HOST is UP"
else
  echo "âŒ $HOST is DOWN"
  # å‘é€å‘Šè­¦é‚®ä»¶
  echo "$result" | mail -s "Alert: $HOST is DOWN" "$ALERT_EMAIL"
fi
```

## æœ€ä½³å®è·µ

### 1. æµ‹è¯•æ–°æ’ä»¶

å¼€å‘æ–°æ’ä»¶æ—¶ï¼Œä½¿ç”¨ trigger å‘½ä»¤å¿«é€Ÿæµ‹è¯•ï¼š

```bash
# 1. ä¿®æ”¹æ’ä»¶ä»£ç 
vim plugins/ping/ping.go

# 2. é‡æ–°ç¼–è¯‘
make build

# 3. æµ‹è¯•
./bin/sentinel trigger ping 8.8.8.8

# 4. é‡å¤ 1-3 ç›´åˆ°æ»¡æ„
```

### 2. æ•…éšœæ’æŸ¥

å½“ç›‘æ§ç³»ç»ŸæŠ¥å‘Šè®¾å¤‡å¼‚å¸¸æ—¶ï¼š

```bash
# 1. ç«‹å³æ‰‹åŠ¨æ£€æŸ¥
./bin/sentinel trigger ping <device-ip> -n 10

# 2. æŸ¥çœ‹è¯¦ç»†ç»“æœ
# 3. æ ¹æ®ç»“æœåˆ¤æ–­æ˜¯ç½‘ç»œé—®é¢˜è¿˜æ˜¯è®¾å¤‡é—®é¢˜
```

### 3. æ€§èƒ½æµ‹è¯•

æµ‹è¯•ä¸åŒå‚æ•°å¯¹é‡‡é›†æ€§èƒ½çš„å½±å“ï¼š

```bash
# æµ‹è¯•ä¸åŒ count
time ./bin/sentinel trigger ping 8.8.8.8 -n 1
time ./bin/sentinel trigger ping 8.8.8.8 -n 10
time ./bin/sentinel trigger ping 8.8.8.8 -n 100

# æµ‹è¯•ä¸åŒ interval
time ./bin/sentinel trigger ping 8.8.8.8 -n 10 -i 100ms
time ./bin/sentinel trigger ping 8.8.8.8 -n 10 -i 1s
time ./bin/sentinel trigger ping 8.8.8.8 -n 10 -i 2s
```

## æœªæ¥è®¡åˆ’

è®¡åˆ’æ”¯æŒçš„åŠŸèƒ½ï¼š

- [ ] JSON è¾“å‡ºæ ¼å¼
- [ ] æ›´å¤šæ’ä»¶çš„ trigger æ”¯æŒï¼ˆSNMP, HTTP ç­‰ï¼‰
- [ ] æ‰¹é‡è§¦å‘å¤šä¸ªè®¾å¤‡
- [ ] ç»“æœæ¯”è¾ƒå’Œå†å²è®°å½•
- [ ] ç›´æ¥å‘é€åˆ°æ•°æ®åº“é€‰é¡¹

## æ€»ç»“

`sentinel trigger` å‘½ä»¤æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºï¼š

âœ… **å¿«é€Ÿæµ‹è¯•** - æ— éœ€å¯åŠ¨å®Œæ•´æœåŠ¡
âœ… **å³æ—¶åé¦ˆ** - ç«‹å³æŸ¥çœ‹é‡‡é›†ç»“æœ
âœ… **çµæ´»ä½¿ç”¨** - å¯é›†æˆåˆ°è„šæœ¬ä¸­
âœ… **ç®€å•æ˜“ç”¨** - æ— éœ€å¤æ‚é…ç½®

é…åˆæœåŠ¡æ¨¡å¼ä½¿ç”¨ï¼Œå¯ä»¥æ„å»ºå®Œæ•´çš„ç›‘æ§è§£å†³æ–¹æ¡ˆï¼

## å‚è€ƒ

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](../QUICKSTART.md)
- [æ’ä»¶å¼€å‘æŒ‡å—](../plugins/README.md)
- [é…ç½®æ–‡æ¡£](../config/config.example.yaml)

